<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE PLUGIN [
<!ENTITY name "media-player-sync">
<!ENTITY author "v3rm0n">
<!ENTITY version "0.1.0">
<!ENTITY launch "UserUtilities/MediaPlayerSync">
<!ENTITY pluginURL "https://raw.githubusercontent.com/v3rm0n/unraid-mp/main/media-player-sync.plg">
]>
<PLUGIN name="&name;" author="&author;" version="&version;" pluginURL="&pluginURL;" launch="&launch;">
  <CHANGES>
###0.1.0
- Initial release
  </CHANGES>

  <FILE Name="/usr/local/emhttp/plugins/media-player-sync/MediaPlayerSync.page">
    <URL>https://raw.githubusercontent.com/v3rm0n/unraid-mp/main/usr/local/emhttp/plugins/media-player-sync/MediaPlayerSync.page</URL>
  </FILE>
  <FILE Name="/usr/local/emhttp/plugins/media-player-sync/MediaPlayerSync.php">
    <URL>https://raw.githubusercontent.com/v3rm0n/unraid-mp/main/usr/local/emhttp/plugins/media-player-sync/MediaPlayerSync.php</URL>
  </FILE>
  <FILE Name="/usr/local/emhttp/plugins/media-player-sync/api.php">
    <URL>https://raw.githubusercontent.com/v3rm0n/unraid-mp/main/usr/local/emhttp/plugins/media-player-sync/api.php</URL>
  </FILE>
  <FILE Name="/usr/local/emhttp/plugins/media-player-sync/plugin.css">
    <URL>https://raw.githubusercontent.com/v3rm0n/unraid-mp/main/usr/local/emhttp/plugins/media-player-sync/plugin.css</URL>
  </FILE>
  <FILE Name="/usr/local/emhttp/plugins/media-player-sync/README.md">
    <URL>https://raw.githubusercontent.com/v3rm0n/unraid-mp/main/usr/local/emhttp/plugins/media-player-sync/README.md</URL>
  </FILE>

  <FILE Name="/etc/sudoers.d/media-player-sync" Mode="0440">
    <INLINE>
# Allow nobody user to mount/unmount FAT32 devices for media-player-sync plugin
Cmnd_Alias MPS_MOUNT = /bin/mount -t vfat *, /bin/umount *
nobody ALL=(root) NOPASSWD: MPS_MOUNT
    </INLINE>
  </FILE>

  <FILE Run="/bin/bash">
    <INLINE>
# Ensure sudoers file has correct permissions
chmod 0440 /etc/sudoers.d/media-player-sync 2>/dev/null || true

# Create plugin directories
mkdir -p /boot/config/plugins/media-player-sync/logs
mkdir -p /boot/config/plugins/media-player-sync
chown -R nobody:users /boot/config/plugins/media-player-sync 2>/dev/null || true
    </INLINE>
  </FILE>
</PLUGIN>
